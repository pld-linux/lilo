#! /bin/sh /usr/share/dpatch/dpatch-run
## 20_devmapper-use-major-minor.patch.dpatch by Loic Minier <lool@dooz.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad lilo-22.7.3~/geometry.c lilo-22.7.3/geometry.c
--- lilo-22.7.3~/geometry.c	2007-01-31 15:20:37.000000000 +0100
+++ lilo-22.7.3/geometry.c	2007-01-31 15:20:43.000000000 +0100
@@ -930,8 +930,9 @@
 	    slash++;
 		else
 	    slash = dmdev;
-	    if (!dm_task_set_name(dmt, slash))
-		die("device-mapper: dm_task_set_name(\"%s\") failed",dmdev);
+	    if (!dm_task_set_major(dmt, MAJOR(device)) ||
+	        !dm_task_set_minor(dmt, MINOR(device)))
+		die("device-mapper: dm_task_set_major() or dm_task_set_minor() failed");
 	    if (!dm_task_run(dmt))
 		die("device-mapper: dm_task_run(DM_DEVICE_TABLE) failed");
 
